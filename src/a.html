<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<style>
    table {
        border-collapse: collapse;
    }
    td, th {
        border-bottom: 1px solid #ccc;
        padding: 10px;
        text-align: left;
    }
    td:last-child {
        text-align: right;
    }
</style>
<div id="homework-container">
    <input type="text" id="add-name-input" placeholder="name" />
    <input type="text" id="add-value-input" placeholder="value" />
    <button id="add-button">Добавить</button>
    <br />
    <br />
    <input type="text" id="filter-name-input" placeholder="filter" />

    <div id="list-table"></div>
</div>

<script>
    /**
     * ДЗ 7.2 - Создать редактор cookie с возможностью фильтрации
     *
     * На странице должна быть таблица со списком имеющихся cookie:
     * - имя
     * - значение
     * - удалить (при нажатии на кнопку, выбранная cookie удаляется из браузера и таблицы)
     *
     * На странице должна быть форма для добавления новой cookie:
     * - имя
     * - значение
     * - добавить (при нажатии на кнопку, в браузер и таблицу добавляется новая cookie с указанным именем и значением)
     *
     * Если добавляется cookie с именем уже существующией cookie, то ее значение в браузере и таблице должно быть обновлено
     *
     * На странице должно быть текстовое поле для фильтрации cookie
     * В таблице должны быть только те cookie, в имени или значении которых есть введенное значение
     * Если в поле фильтра пусто, то должны выводиться все доступные cookie
     * Если дабавляемая cookie не соответсвуте фильтру, то она должна быть добавлена только в браузер, но не в таблицу
     * Если добавляется cookie, с именем уже существующией cookie и ее новое значение не соответствует фильтру,
     * то ее значение должно быть обновлено в браузере, а из таблицы cookie должна быть удалена
     *
     * Для более подробной информации можно изучить код тестов
     *
     * Запрещено использовать сторонние библиотеки. Разрешено пользоваться только тем, что встроено в браузер
     */

    /**
     * homeworkContainer - это контейнер для всех ваших домашних заданий
     * Если вы создаете новые html-элементы и добавляете их на страницу, то дабавляйте их только в этот контейнер
     *
     * @example
     * homeworkContainer.appendChild(...);
     */

    let homeworkContainer = document.querySelector('#homework-container');
    let listTableDiv = homeworkContainer.querySelector('#list-table');
    let addButton = homeworkContainer.querySelector('#add-button');

    createTableCookie(getCookie());

    let filterNameInput = homeworkContainer.querySelector('#filter-name-input');
    let addNameInput = homeworkContainer.querySelector('#add-name-input');
    let addValueInput = homeworkContainer.querySelector('#add-value-input');
    let listTable = homeworkContainer.querySelector('#list-table tbody');

    function createTableCookie(cookieArr) {
        //let cookieArr = getCookie();

        var table = '<table><tbody><tr><th>NAME</th><th>VALUE</th><th>Delete cookie</th></tr>';

        for(let key in cookieArr) {
            table += '<tr><td>' + cookieArr[key].name + '</td><td>' + cookieArr[key].value + '</td><td><button>удалить</button></td></tr>';
        }

        table += '</tbody></table>';
        listTableDiv.innerHTML = table;
    }

    createCookie('_we_', 'w21q1223ew4324o52ieo');
    createCookie('_you_', 'ew4324o52ieo');
    createCookie('_they_', 'they-ew4324o52ieo');

    filterNameInput.addEventListener('keyup', function() {

        var cookieArrNew = [];
        var cookieArr = getCookie();

        for(let i = 0; i < cookieArr.length; i++) {
            if ( isMatching(cookieArr[i].name, filterNameInput.value) ) {
                cookieArrNew.push({
                    name: cookieArr[i].name,
                    value: cookieArr[i].value
                });
            }
        }

        //console.log(cookieArrNew);
        createTableCookie(cookieArrNew);
    });

    addButton.addEventListener('click', () => {
        if (!addNameInput.value == "" || !addValueInput.value == "") {
            createCookie(addNameInput.value, addValueInput.value);
        }
        addNameInput.value = addValueInput.value = '';
        createTableCookie(getCookie());
    });

    listTable.addEventListener('click', function (e) {
        //console.log(e);
        if (e.target.tagName == 'BUTTON') {
            let delParent = e.target.parentNode.parentNode;
            let delCookie = delParent.firstChild.textContent;
            deleteCookie(delCookie);
            listTable.deleteRow(delParent.rowIndex);
        }
    });

    function createCookie(name, value) {
        document.cookie = name + '=' + value;
    }

    function deleteCookie(name) {
        let date = new Date(0);
        createCookie(name, "; expires=" + date.toUTCString());
    }

    function getCookie() {
        let cookieStr = document.cookie;
        let cookieArr = cookieStr.split('; ');
        let cookieNameArr = new Array({name: '', value: ''});

        for (let i = 0; i < cookieArr.length; i++) {
            let keyCookie = cookieArr[i].split('=');
            cookieNameArr[i] = {
                name: keyCookie[0],
                value: keyCookie[1]
            };
        }

        return cookieNameArr;
    }

    function isMatching (full, chunk) {
        full = full.toLowerCase();
        chunk = chunk.toLowerCase();

        if( ~full.indexOf(chunk) && chunk.length != 0 ) {
            return true;
        }

        return false;
    }

</script>

</body>
</html>